{
  "hash": "f378d17b437d75858c563dd797f5b1a7",
  "result": {
    "markdown": "# Hierarchically structured spatial metapopulation models {#sec-intro}\n\n\n::: {.cell}\n\n:::\n\n\nIn the previous chapter, we observed the construction of a meta-population mixing matrix from empirical origin-destination (OD) data. The patches used in the example were based on the 'SA3' regions of the Australian Statistical Geography Standard's Statistical Areas (SA) classification (comprising 40 patches for the Greater Melbourne area).\n\nAn important feature of the SA classification structure is that there is more than one scale of classification and that lower levels of SA are hierarchically nested within higher levels (it is a hierarchichally organised classification scheme). The SA2 - SA4 level regions Greater Melbourne area are shown in @fig-GMelbSA2SA3SA4\n\n\n::: {.cell .column-margin}\n\n:::\n\n::: {.cell .column-margin}\n::: {.cell-output-display}\n![](03-CurrentStudy_files/figure-html/fig-GMelbSA2SA3SA4-1.png){#fig-GMelbSA2SA3SA4 width=604.8}\n:::\n:::\n\n\nFor example, the Maribyrnong SA3 region sits inside the 'West Melbourne' SA4 region alongside Essendon (SA3) @fig-FootscraySAexample. Both West Melbourne and the neighbouring 'Inner Melbourne' (SA4) are part of the Greater Melbourne area. Moreover, within Marybirnong (SA3) there are six SA2 level regions (Braybrook, Footscray, Maribyrnong, Seddon - Kingsville, West Footscray - Tottenham, Yarraville), which can likewise be partitioned in to smaller SA1 level and 'Mesh Block' level regions @fig-ASGS.\n\n\n::: {.cell .column-margin}\n::: {.cell-output-display}\n![](03-CurrentStudy_files/figure-html/fig-FootscraySAexample-1.png){#fig-FootscraySAexample width=604.8}\n:::\n:::\n\n\n![Structure of The Australian Statistical Geography Standard (ASGS)](ASGS_Diagram_2021.png){#fig-ASGS width=\"464\"}\n\nHelpfully, Statistical Areas are also indexed by a structured code representing their classification hierarchy. For example, SA1 regions are denoted by an 11 digit code which can be decomposed into the higher level areas in which the region sits. @fig-FootscraySA1Code demonstrates this for an SA1 region in the area considered above.\n\n![FootscraySA1code](FootscraySA1eg.png){#fig-FootscraySA1Code}\n\n### Construction of hierarchical mixing matrix\n\nWe can exploit this hierarchical structure by creating meta-population models incorporating the same overarching spatial structure (i.e. the ASGS Statistical Areas structure), but with varying levels of resolution (e.g. by using SA2 scale patches instead of SA3 scale patches).\n\nThe resulting mixing matrices will be of different sizes (i.e. 40 SA3 patches vs 361 SA2 patches for the Greater Melbourne region), and to ensure equivalent representation of aggregate levels, patch population size can be used to scale mixing coefficients, i.e.\n\n$$\n\\phi_{ij} = N_j/N_{tot}\n$$\n\nWhich gives mixing matrices shown in @fig-GMelbPopMM\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\nRows: 361 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): SA2_Name\ndbl (2): SA2_Code, Pop\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\nRows: 40 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): SA3_Name\ndbl (2): SA3_Code, SA3_pop\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\nRows: 9 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): SA4_Name\ndbl (2): SA4_Code, SA4_pop\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n```\n:::\n\n::: {.cell-output-display}\n![](03-CurrentStudy_files/figure-html/unnamed-chunk-5-1.png){width=604.8}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[2]]\n```\n:::\n\n::: {.cell-output-display}\n![](03-CurrentStudy_files/figure-html/unnamed-chunk-5-2.png){width=604.8}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[3]]\n```\n:::\n\n::: {.cell-output-display}\n![](03-CurrentStudy_files/figure-html/unnamed-chunk-5-3.png){width=604.8}\n:::\n:::\n\n\nTo implement this, we posit two main constraints on mixing between patches:\n\n1\\. For a given level of spatial structure,(e.g. SA2, SA3, SA4 etc.), individuals from patches within the same region will have a higher probability of mixing than will than will those from patches in different regions.\n\n2\\. This mixing will be proportional to the population size\n\nThe main constraint employed was that patches within the same level $L$ SA region would mix together more strongly than those not. Nevertheless, because of a higher level enclosing group (in the case of Melbourne, the state level grouping), we only need to specify a series of coefficients which correspond to the lowest level grouping in which two patches co-occur. Furthermore, to ensure the matrix rows sum to one, mixing is also proportional to the fraction of the population of the grouping region comprised by the patch.\n\nfor any two patches $i$ and $j$,\n\n$i, j$ are patches\n\n$S_{i}^{L}$ is the set of patches in level $L$ $N_i$ is the population of $i$ $N_{i}^{L}$ is the population of $S_{i}^{L}$ $\\xi^{L}(\\delta)$ is the proportion of mixing that occurs within $S_{i}^{L}$ but not$S_{i}^{L-1}$\n\n$M_{ij} = \\frac{N_{j}}{N_{i}^{L} - N_{i}^{L-1}} \\xi^{L}$ if $j \\in S_{i}^{L}$ & $j \\in S_{i}^{L-1}$ \\## Spatial Metapopulation Model\n\n### Specification\n\nWe employ a basic $SIR$ compartmental model, assuming no births and deaths, with a total of $N$ individuals. $$ S + I  + R = N$$ {#eq-ConstantTotalPopulation}\n\nWe divide the population into $n$ connected sub-populations,hereafter 'patches', with $N_i$ denoting the population of patch $i$ (note that $N = \\sum\\limits_{i=1}^{n}N_i$).\n\nLet $S_i$, $I_i$, $R_i$ respectively denote the number of susceptible, infected and recovered individuals in Patch $i$ (noting also that $N_i = S_i + I_i + R_i$). Also, since $R_i = N_i - S_i - I_i$, we will not explicitly show $R_i$ in the equations hereafter (thought this could be calculated at any time)\n\nIndividuals coming into contact with an infective, whether within or without patch, become infected at a rate $\\beta$.\n\nWhile individuals do not migrate between patches, infectives from patch $i$ infect - individuals from $j$ with a proportion $\\phi_{ij}$.\n\nThe force of infection in patch $i$ given by $$\n\\Lambda_i = \\beta \\sum\\limits_{j}^{n}\\phi_{ij}I_j\n$$\n\nAnd thus the force of infection vector $$\\Lambda = \\beta I \\Phi$$ {#eq-FOIv}\n\nWhere $I$ is the vector of patch infection counts, and $\\Phi$ is the mixing matrix.\n\n### Construction of mixing matrix\n\nInstead of constructing the mixing matrix from empirical OD data, we specified the matrix analytically to encode the hierarchical structure of the SA classification.\n\nThe main constraint employed was that patches within the same level $L$ SA region would mix together more strongly than those not. Nevertheless, because of a higher level enclosing group (in the case of Melbourne, the state level grouping), we only need to specify a series of coefficients which correspond to the lowest level grouping in which two patches co-occur. Furthermore, to ensure the matrix rows sum to one, mixing is also proportional to the fraction of the population of the grouping region comprised by the patch.\n\nfor any two patches $i$ and $j$,\n\n$i, j$ are patches\n\n$S_{i}^{L}$ is the set of patches in level $L$ $N_i$ is the population of $i$ $N_{i}^{L}$ is the population of $S_{i}^{L}$ $\\xi^{L}(\\delta)$ is the proportion of mixing that occurs within $S_{i}^{L}$ but not$S_{i}^{L-1}$\n\nThe intra level mixing coefficients $\\xi_L$ comprise the vector $\\xi$. Constraining the elements of $\\xi$ s.t. $\\sum\\limits_{L = 1}^{L} \\xi_i = 1$ (where $L$ is the highest level grouping) ensures the rows of the mixing matrix sum to unity.\\\n\n-More verbosity\n\n-Be more explicit about SA Levels\n\n-Mention Mixing with PPMM\n\n### Implementation\n\nThe model was implemented as continuous time markov chain, with discrete state variables $$S_{i}(t), I_{i}(t) \\in {0,1,2,...N_{i}}$$ where $t\\in [0, \\infty)$\n\nat $t = 0$, a randomly selected patch, $i$, is seeded with $I = 10$ invectives, such that $$S_{i}(0) = N_{i} - 10, I_{i}(0) = 10$$ and the remaining patches are disease free $$S_j(0) = N_j, I_j(0) =0, i\\neq j $$\n\nat $t>0$ possible changes in state ('events') are infection at a patch $i$ (if $S_i \\geq 1$ & $I \\geq 1$), or recovery at patch $i$ (if $I_i \\geq 1$). Rates for these events are given in @tbl-EventRates\n\n| Event                  | State change         | Rate            |\n|------------------------|----------------------|-----------------|\n| Infection in patch $i$ | $\\{S_i -1, I_i +1\\}$ | $S_i \\Lambda_i$ |\n| Recovery in patch $i$  | $\\{I_i - 1\\}$        | $\\gamma I_i$    |\n\n: Event Rates {#tbl-EventRates}\n\nDue to the Markov property, events occur after a exponentially distributed time with parameter equal to the sum of all event rates $$\\Delta t \\sim Exp(\\lambda)$$ where\n\n$\\lambda = \\sum\\limits_{i}^{n}S_i \\Lambda_i + \\gamma I_i$\n\nat $t + \\delta t$, a random event from @tbl-EventRates will occur with probability directly proportional to it's rate.\n\nWhen the system enters a disease free equilibrium state (i.e. $I = 0$), the implementation is complete.\n",
    "supporting": [
      "03-CurrentStudy_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}